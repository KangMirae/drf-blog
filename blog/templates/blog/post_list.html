{% extends 'base.html' %}
{% block title %}ê¸€ ëª©ë¡{% endblock %}
{% block content %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¸”ë¡œê·¸ ê¸€ ëª©ë¡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-5">
    <h1 class="mb-4">ğŸ“„ ë¸”ë¡œê·¸ ê¸€ ëª©ë¡</h1>

    <form id="search-form" class="mb-4 d-flex" role="search">
        <input type="text" id="search-input" class="form-control me-2" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        <button type="submit" class="btn btn-primary">ê²€ìƒ‰</button>
    </form>

    <p id="search-status" class="text-muted mb-2"></p>
    <button id="reset-button" class="btn btn-outline-secondary btn-sm mb-3" style="display: none;">
        ì „ì²´ ê¸€ ë³´ê¸°
    </button>
    <ul id="post-list" class="list-group"></ul>
    <script>
        const list = document.getElementById('post-list');
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const statusText = document.getElementById('search-status');
        const resetButton = document.getElementById('reset-button');

        function loadPosts(query = '') {
            const url = query ? `/api/posts/?search=${encodeURIComponent(query)}` : '/api/posts/';
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    list.innerHTML = '';
                    if (data.length === 0) {
                        list.innerHTML = '<li class="list-group-item text-muted">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
                    } else {
                        data.forEach(post => {
                            const item = document.createElement('li');
                            item.className = 'list-group-item';
                            item.innerHTML = `
                                <a href="/post/${post.id}/" class="text-decoration-none">
                                    <strong>${post.title}</strong>
                                </a><br>
                                <small>ì‘ì„±ì: ${post.author}</small>
                                <span class="badge bg-light text-dark ms-2">ğŸ’¬ ${post.comment_count}ê°œ</span>
                            `;


                            list.appendChild(item);
                        });
                    }
                    statusText.textContent = query ? `"${query}"ë¡œ ê²€ìƒ‰í•œ ê²°ê³¼ (${data.length}ê°œ)` : '';
                    resetButton.style.display = query ? 'inline-block' : 'none';
                });
        }

        searchForm.addEventListener('submit', e => {
            e.preventDefault();
            const keyword = searchInput.value.trim();
            loadPosts(keyword);
        });

        resetButton.addEventListener('click', () => {
            searchInput.value = '';
            loadPosts();  // ì „ì²´ ëª©ë¡ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
        });

        // ì²˜ìŒ í˜ì´ì§€ ë¡œë”© ì‹œ ì „ì²´ ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
        loadPosts();
    </script>
</body>
</html>
{% endblock %}